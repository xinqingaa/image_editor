<!-- 2b5b32ca-f061-45c9-a6b3-bc91cf01e036 aaf54d49-f0c1-4a80-9d44-da4147a6864d -->
# 修复图片显示宽度和裁剪框边界问题

## 问题分析

### 问题1：图片宽度不是100%

- 当前 `_initializeImageScale()` 使用 `paddingFactor = 0.92`，导致图片只占画布的92%
- 用户希望图片宽度占满设备的100%
- 需要根据图片宽高比和画布宽高比，让限制方向占满100%

### 问题2：裁剪框超出图片

- 当前 `_initializeCropRect()` 基于画布尺寸计算，没有考虑旋转后图片的实际显示区域
- 当图片旋转后，图片的显示边界框会变大，但裁剪框初始化时没有考虑这一点
- 需要计算旋转后图片在屏幕上的实际显示边界，确保裁剪框不超出

## 实现方案

### 1. 修复图片缩放逻辑

**位置**：`lib/controller/image_editor_controller.dart` 的 `_initializeImageScale()` 方法

- 移除 `paddingFactor`，让图片占满100%
- 根据图片和画布的宽高比，计算合适的缩放比例
- 如果图片宽度是限制因素，让宽度占满100%；如果高度是限制因素，让高度占满100%

### 2. 修复裁剪框初始化逻辑

**位置**：`lib/controller/image_editor_controller.dart` 的 `_initializeCropRect()` 方法

- 计算旋转后图片在屏幕上的实际显示边界框
- 考虑旋转角度和缩放比例，计算图片的实际显示区域
- 确保裁剪框初始化时不超过图片的实际显示区域
- 在 `_onCropDragUpdate()` 中也需要添加边界检查，防止拖动时超出

### 3. 添加辅助方法

- 添加方法计算旋转后图片在屏幕上的实际显示边界框
- 这个方法需要考虑：图片尺寸、旋转角度、缩放比例、画布中心位置

## 实现细节

1. **图片缩放**：

- 计算 `widthRatio = canvasWidth / imageWidth`
- 计算 `heightRatio = canvasHeight / imageHeight`
- 取较小值，确保图片完整显示且占满限制方向

2. **裁剪框边界**：

- 计算旋转后图片的四个角在屏幕上的坐标
- 找到这些坐标的最小/最大边界，得到图片的实际显示区域
- 裁剪框必须在这个区域内

### To-dos

- [ ] 修复 _captureTransformedImage() 方法，使用原图像素尺寸而非屏幕尺寸进行导出
- [ ] 实现计算变换后图片实际像素尺寸的逻辑（考虑旋转和缩放）
- [ ] 添加 FilterQuality.high 保持高清晰度
- [ ] 修复文本图层坐标转换，确保在导出图片中位置正确
- [ ] 验证裁剪后图片尺寸计算是否正确