<!-- 2b5b32ca-f061-45c9-a6b3-bc91cf01e036 49ea8b3c-2534-4cd9-add2-2c827f41728d -->
# 修复图片导出清晰度和尺寸问题

## 问题分析

1. **清晰度问题**：`_captureTransformedImage()` 使用画布尺寸（屏幕像素，如390x844）作为导出尺寸，而不是原图的实际像素尺寸（1280x1707），导致清晰度大幅降低。

2. **尺寸问题**：导出图片的尺寸固定为画布尺寸，而不是根据变换后的图片实际尺寸计算。

3. **裁剪后尺寸问题**：应用裁剪后，新图片的尺寸应该正确反映裁剪区域在原图中的像素尺寸。

## 修复方案

### 1. 修复 `_captureTransformedImage()` 方法

- **位置**：`lib/controller/image_editor_controller.dart` 第476-515行
- **修改内容**：
- 计算变换后图片的实际像素尺寸（考虑旋转和缩放）
- 使用原图像素尺寸而非屏幕尺寸进行导出
- 添加 `FilterQuality.high` 保持高清晰度
- 正确计算文本图层在像素坐标系中的位置

### 2. 优化尺寸计算逻辑

- 计算旋转后的图片边界框尺寸
- 根据当前 `_scale` 和 `_currentRotationAngle` 计算实际需要的像素尺寸
- 确保导出尺寸匹配变换后图片的实际显示区域

### 3. 验证裁剪逻辑

- 确认 `_captureHiResCroppedImage()` 正确计算裁剪区域在原图中的像素坐标
- 确保应用裁剪后，新图片尺寸正确

## 实现细节

1. **计算变换后图片的实际像素尺寸**：

- 考虑旋转角度，计算旋转后的边界框
- 考虑缩放比例，计算最终需要的像素尺寸
- 使用原图尺寸作为基准，而不是屏幕尺寸

2. **高保真绘制**：

- 使用 `FilterQuality.high`
- 使用原图的实际像素尺寸创建画布

3. **文本图层坐标转换**：

- 将屏幕坐标转换为像素坐标
- 确保文本在导出图片中的位置正确

### To-dos

- [ ] 修复 _captureTransformedImage() 方法，使用原图像素尺寸而非屏幕尺寸进行导出
- [ ] 实现计算变换后图片实际像素尺寸的逻辑（考虑旋转和缩放）
- [ ] 添加 FilterQuality.high 保持高清晰度
- [ ] 修复文本图层坐标转换，确保在导出图片中位置正确
- [ ] 验证裁剪后图片尺寸计算是否正确